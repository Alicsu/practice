<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Computed</title>
	<style>
		/* CSS样式表：定义了程序输出的样式 */
		.output {
			/* 计算结果定义为粗体 */
			font-weight: bold;
		}
		#payment {
			/* 定义id="payment"的元素样式 */
			text-decoration: underline;
		}
		#graph {border:1px solid #000;}
		th, td {
			/* 表格单元格对齐方式为顶端对齐 */
			vertical-align: top;
		}
	</style>
</head>
<body>
	<!-- 这是一个HTML表格，其中包含input元素可以用来输入数据，程序将在span元素中显示计算结果 -->
	<table>
		<tr>
			<th>Enter Loan Data:</th>
			<td></td>
			<th>Load Balance,Cumulative Equity, and Interest Payments</th>
		</tr>
		<tr>
			<td>Amount of the loan($):</td>
			<td><input id="amount" onchange="calculate();"></td>
			<td rowspan="8">
				<canvas id="graph" width="400" height="250"></canvas>
			</td>
		</tr>
		<tr>
			<td>Annual interest(%):</td>
			<td><input id="apr" onchange="calculate();"></td>
		</tr>
		<tr>
			<td>Repayment period(years):</td>
			<td><input id="years" onchange="calculate();"></td>
		</tr>
		<tr>
			<td>Zipcode (to find lenders):</td>
			<td><input id="zipcode" onchange="calculate();"></td>
		</tr>
		<tr>
			<th>Approximate Payments:</th>
			<td><button onclick="calculate();">Calculate</button></td>
		</tr>
		<tr>
			<td>Monthly payment:</td>
			<td>$<span class="output" id="payment"></span></td>
		</tr>
		<tr>
			<td>Total payment:</td>
			<td>$ <span class="output" id="total"></span></td>
		</tr>
		<tr>
			<td>Total interest:</td>
			<td>$ <span class="output" id="totalinterest"></span></td>
		</tr>
		<tr>
			<th>Sponsors:</th>
			<td colspan="2">
				Apply for your loan with one of these fine lenders:
				<div id="lenders"></div>
			</td>
		</tr>
	</table>

	<!-- 添加script代码，这些代码放置在HTML代码之后便于理解 -->
	<script>
		"use strict";  //如果浏览器支持的话，则开启ECMAScript5的严格模式
		function calculate() {
			//查找文档中用于输入输出的元素
			var amount = document.getElementById("amount");
			var apr = document.getElementById("apr");
			var years = document.getElementById("years");
			var zipcode = document.getElementById("payment");
			var total = document.getElementById("total");
			var totalinterest = document.getElementById("totalinterest");

			//假设输入都是合法的，将从input元素中获取输入数据
			// 将百分比格式转换成小数格式，并从年利率转换为月利率，将年度赔付转换为月度赔付
			var principal = parseFloat(amount.value);
			var interest = parseFloat(apr.value)/100/12;
			var payments = parseFloat(years.value)*12;

			// 现在计算月度赔付的数据
			var x = Math.pow(1 + interest,payments); //Math.pow()进行幂次计算
			var monthly = (principal * x * interest) / (x-1);

			if (isFinite(monthly)) {
				// 将数据填充至输出字段的位置，四舍五入到小数点后两位数字
				payment.innerHTML = monthly.toFixed(2);
				total.innerHTML = (monthly * payments).toFixed(2);
				totalinterest.innerHTML = ((monthly*payments) - principal).toFixed(2);

				//将用户的输入数据保存下来，这样在下次访问时也能取到数据
				save(amount.value,apr.value,years.value,zipcode.value);

				//找到并展示本地放贷人，但忽略网络错误
				try {
					//捕获这段代码抛出的所有异常
					getLenders(amount.value,apr.value,years.value,zipcode.value);
				}
			catch(e) {/*忽略这些异常*/}

			//最后，用图表展示贷款余额，利息和资产收益
			chart(principal,interest,monthly,payments);
			}
		}
	</script>
</body>
</html>